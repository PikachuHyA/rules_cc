---
x_defaults:
  # YAML has a feature for "repeated nodes", BazelCI is fine with extra nodes
  # it doesn't know about; so that is used to avoid repeating common subparts.
  common: &common
    # We exclude //examples/... because it can only be built / tested with Bazel HEAD.
    build_targets:
    - "//..."
    - "-//examples/..."
    test_flags:
    - "--test_timeout=300"
    test_targets:
    - "//..."
    - "-//examples/..."

buildifier:
  version: latest
  warnings: "all"

tasks:
  ubuntu1604:
    <<: *common
  ubuntu1804:
    <<: *common
  macos:
    <<: *common
  windows:
    <<: *common
  examples:
    platform: ubuntu1804
    bazel: last_green
    build_targets:
    - "//examples/..."
    test_flags:
    - "--test_timeout=300"
    test_targets:
    - "//examples"
